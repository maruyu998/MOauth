<svg xmlns="http://www.w3.org/2000/svg" width="1155.8203125px" height="1181.859375px" class="sequence simple"><desc>moauth flow</desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"/></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"/></marker></defs><g class="title"><rect x="10" y="10" width="102.40625" height="25.609375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="15" y="28.203125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="15">moauth flow</tspan></text></g><g class="actor"><rect x="76.3984375" y="45.609375" width="78.8125" height="35.609375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="86.3984375" y="68.8125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="86.3984375">Browser</tspan></text></g><g class="actor"><rect x="76.3984375" y="1126.25" width="78.8125" height="35.609375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="86.3984375" y="1149.453125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="86.3984375">Browser</tspan></text></g><line x1="115.8046875" x2="115.8046875" y1="81.21875" y2="1126.25" stroke="#000000" fill="none" style="stroke-width: 2;"/><g class="actor"><rect x="365.203125" y="45.609375" width="95.609375" height="35.609375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="375.203125" y="68.8125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="375.203125">AppServer</tspan></text></g><g class="actor"><rect x="365.203125" y="1126.25" width="95.609375" height="35.609375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="375.203125" y="1149.453125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="375.203125">AppServer</tspan></text></g><line x1="413.0078125" x2="413.0078125" y1="81.21875" y2="1126.25" stroke="#000000" fill="none" style="stroke-width: 2;"/><g class="actor"><rect x="851.4140625" y="45.609375" width="104" height="35.609375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="861.4140625" y="68.8125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="861.4140625">AuthServer</tspan></text></g><g class="actor"><rect x="851.4140625" y="1126.25" width="104" height="35.609375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="861.4140625" y="1149.453125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="861.4140625">AuthServer</tspan></text></g><line x1="903.4140625" x2="903.4140625" y1="81.21875" y2="1126.25" stroke="#000000" fill="none" style="stroke-width: 2;"/><g class="signal"><text x="142.6015625" y="111.6171875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="142.6015625">access a signin-required page</tspan></text><line x1="115.8046875" x2="413.0078125" y1="116.828125" y2="116.828125" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="note"><rect x="286.203125" y="136.828125" width="253.609375" height="64.015625" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="291.203125" y="155.03125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="291.203125">get the requested page</tspan><tspan dy="1.2em" x="291.203125">when access_token and user_id</tspan><tspan dy="1.2em" x="291.203125">are saved in the session</tspan></text></g><g class="signal"><text x="163.6015625" y="231.2421875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="163.6015625">(get the requested page)</tspan></text><line x1="413.0078125" x2="115.8046875" y1="236.453125" y2="236.453125" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"/></g><g class="note"><rect x="332.40625" y="256.453125" width="161.203125" height="44.8125" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="337.40625" y="274.65625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="337.40625">save requested uri</tspan><tspan dy="1.2em" x="337.40625">to session</tspan></text></g><g class="signal"><text x="448.2109375" y="331.6640625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="448.2109375">[POST:{AUTH_URI}/api/app_token] app_id, app_secret</tspan></text><line x1="413.0078125" x2="903.4140625" y1="336.875" y2="336.875" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="note"><rect x="780.8125" y="356.875" width="245.203125" height="25.609375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="785.8125" y="375.078125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="785.8125">validate app_id &amp; app_secret</tspan></text></g><g class="note"><rect x="835.4140625" y="402.484375" width="136" height="25.609375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="840.4140625" y="420.6875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="840.4140625">issue app_token</tspan></text></g><g class="signal"><text x="620.40625" y="458.4921875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="620.40625">app_token</tspan></text><line x1="903.4140625" x2="413.0078125" y1="463.703125" y2="463.703125" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="signal"><text x="481.8046875" y="494.1015625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="481.8046875">[REDIRECT:{AUTH_URI}/signin?app_token=***]</tspan></text><line x1="413.0078125" x2="903.4140625" y1="499.3125" y2="499.3125" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"/></g><g class="signal"><text x="442.40625" y="529.7109375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="442.40625">signin form html</tspan></text><line x1="903.4140625" x2="115.8046875" y1="534.921875" y2="534.921875" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"/></g><g class="note"><rect x="10" y="554.921875" width="211.609375" height="25.609375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="15" y="573.125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="15">enter user_id &amp; password</tspan></text></g><g class="signal"><text x="228.203125" y="610.9296875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="228.203125">[POST:{AUTH_URI}/api/get_access_token] app_token, user_id, password</tspan></text><line x1="115.8046875" x2="903.4140625" y1="616.140625" y2="616.140625" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="note"><rect x="743.0078125" y="636.140625" width="320.8125" height="25.609375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="748.0078125" y="654.34375" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="748.0078125">validate app_token, user_id, password</tspan></text></g><g class="note"><rect x="822.8125" y="681.75" width="161.203125" height="25.609375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="827.8125" y="699.953125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="827.8125">issue access_token</tspan></text></g><g class="signal"><text x="316.40625" y="737.7578125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="316.40625">[REDIRECT:{APP_URI}/callback?access_token=***]</tspan></text><line x1="903.4140625" x2="115.8046875" y1="742.96875" y2="742.96875" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"/></g><g class="signal"><text x="226.6015625" y="773.3671875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="226.6015625">[request]</tspan></text><line x1="115.8046875" x2="413.0078125" y1="778.578125" y2="778.578125" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowOpen&quot;);"/></g><g class="signal"><text x="423.0078125" y="808.9765625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="423.0078125">[POST:{AUTH_URI}/api/validate_access_token] access_token</tspan></text><line x1="413.0078125" x2="903.4140625" y1="814.1875" y2="814.1875" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="note"><rect x="810.2109375" y="834.1875" width="186.40625" height="25.609375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="815.2109375" y="852.390625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="815.2109375">validate access_token</tspan></text></g><g class="note"><rect x="776.609375" y="879.796875" width="253.609375" height="25.609375" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="781.609375" y="898" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="781.609375">get user_id from access_token</tspan></text></g><g class="signal"><text x="570.0078125" y="935.8046875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="570.0078125">user_id, access_token</tspan></text><line x1="903.4140625" x2="413.0078125" y1="941.015625" y2="941.015625" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g><g class="note"><rect x="286.203125" y="961.015625" width="253.609375" height="44.8125" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="291.203125" y="979.21875" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="291.203125">save user_id and access_token</tspan><tspan dy="1.2em" x="291.203125">to session</tspan></text></g><g class="note"><rect x="319.8046875" y="1025.828125" width="186.40625" height="44.8125" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"/><text x="324.8046875" y="1044.03125" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="324.8046875">restore requested uri</tspan><tspan dy="1.2em" x="324.8046875">from session</tspan></text></g><g class="signal"><text x="125.8046875" y="1101.0390625" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="125.8046875">[REDIRECT] get the requested page</tspan></text><line x1="413.0078125" x2="115.8046875" y1="1106.25" y2="1106.25" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"/></g></svg>